<?xml version="1.0" ?>

<!-- Unit test for connections -->
<!--
     There are several "snails" that are crawling to one direction
     The the less mass of snail the much its velocity  
     The snail that is crawling first eat more food and thus increase its mass
     The snail that falls behind gets less food and thus loosing its mass
     Also the snail can be frugal, which doesn't eat the whole portion, thus more food remains for the followers 

     The following use cases are tested:
     1. Object output extending of multiple state outputs to one bus
     2. Object input extending of multiple state inputs to one bus
     3. State input multiple connestion to outputs (snail.mass.neighbor to snail.out) 

     -->

 <!-- State [mass], inputs
 coord_self - corrdinates of snail
 frugal - if the snail is frugal
 neighbor - status of other snails: coordinate and sign of frugality -->

<!DOCTYPE  iobject SYSTEM "/home/yborisov/projects/fap/git/fapws/src/objspec.dtd"> 

    <iobject type="none" id="main_test">
	<mut>
	    <add>
		<iobject type="none" id="snail" quiet="yes"> 
		    <mut>
			<add>

			    <inp id="neighbor">
				<dest id="coord"/> <dest id="frugal"/> 
			    </inp>
			    <out id="coord"/>
			    <!-- Custom output connection point: contains two pins on srcs: [coord] and [vip] -->
			    <out id="outp">
				<src id="coord"/> <src id="frugal"/> 
			    </out>

			    <logspec  event="cre"> <logdata id="new"/> </logspec>

			    <state type="StUint32" id="mass" transf="trans_mass" init="2"> 
				<logspec event="upd"> <logdata id="new"/> </logspec> 
				<inp id="coord_self"/> <inp id="frugal"/> 
				<inp id="neighbor"> 
				    <dest id="coord"/> <dest id="frugal"/> 
				</inp>
			    </state>

			    <state type="StUint32" id="coord" len="4" transf="trans_coord" init="0"> 
				<logspec event="upd"> <logdata id="cur"/> <logdata id="new"/> </logspec> 
				<inp id="self"/> <inp id="mass"/> 
			    </state>

			    <state type="StBool" id="frugal" len="4" transf="trans_frugal" init="0"> 
				<logspec event="upd"> <logdata id="cur"/> <logdata id="new"/> </logspec> 
				<inp id="self"/> <inp id="coord"/> <inp id="coord_other"/> 
			    </state>

			    <conn id="state%mass.coord_self" pair="state%coord.output"/> 
			    <conn id="state%mass.frugal" pair="state%frugal.output"/> 
			    <conn id="state%coord.self" pair="state%coord.output"/> 
			    <conn id="state%coord.mass" pair="state%mass.output"/>
			    <conn id="state%frugal.self" pair="state%frugal.output"/>
			    <conn id="state%frugal.coord" pair="state%coord.output"/>

			    <ext id="neighbor" pair="state%mass.neighbor"/>
			    <ext id="coord" pair="state%coord.output"/>
			    <extc id="outp">
				<srcext id="coord" pair="state%coord.output"/>
				<srcext id="frugal" pair="state%frugal.output"/>
			    </extc>
			    <extc id="neighbor">
				<dstext id="state%coord" pair="state%frugal.coord_other"/>
			    </extc>

			</add>
		    </mut>
		</iobject> <!-- snail -->

		<iobject type="snail" id="snail_1" > <mut> <change type="state" id="mass" attr="init" val="7"/> </mut></iobject>
		<iobject type="snail" id="snail_2" > <mut> <change type="state" id="mass" attr="init" val="3"/> </mut></iobject>
		<iobject type="snail" id="snail_3" > 
		    <mut> 
			<change type="state" id="mass" attr="init" val="16"/> 
			<change type="state" id="frugal" attr="init" val="True"/> 
		    </mut>
		</iobject>

		<conn id="snail_1.neighbor" pair="snail_2.outp"/><conn id="snail_1.neighbor" pair="snail_3.outp"/>
		<conn id="snail_2.neighbor" pair="snail_1.outp"/> <conn id="snail_2.neighbor" pair="snail_3.outp"/>
		<conn id="snail_3.neighbor" pair="snail_1.outp"/> <conn id="snail_3.neighbor" pair="snail_2.outp"/>

	    </add>
	</mut>
    </iobject> <!-- test -->

